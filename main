#include <iostream>
#include <Windows.h>
#include <conio.h>

using namespace std;

PROCESS_INFORMATION piWord[] = { 0 };
PROCESS_INFORMATION piExcel[] = { 0 };
PROCESS_INFORMATION piPaint[] = { 0 };
PROCESS_INFORMATION piNotepad[] = { 0 };

void thread() {
    int count = 0;
    while (true) {
        system("cls");
        count++;
        cout << "count = " << count << endl;
        cout << "---------------------------" << endl;
        cout << "Какое приложение открыть?" << endl;
        cout << "1. Word" << endl;
        cout << "2. Exel" << endl;
        cout << "3. Paint" << endl;
        cout << "4. Notepad" << endl;
        cout << "---------------------------" << endl;
        cout << "Какое приложение закрыть?" << endl;
        cout << "5. closeWord" << endl;
        cout << "6. closeExcel" << endl;
        cout << "7. closePaint" << endl;
        cout << "8. closeNotepad" << endl;
        cout << "" << endl;
        cout << "9. Exit" << endl;
        cout << " " << endl;
        Sleep(1500);
    }
}

PROCESS_INFORMATION openWord(wchar_t* app) {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(STARTUPINFO);

    if (!CreateProcess(app, NULL, NULL, NULL, FALSE,
        CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
        cout << "Ошибка - " << GetLastError() << endl;
    }
    else {
        cout << "Программа запущена!" << endl;
    }
    return pi;
}

PROCESS_INFORMATION openExel(wchar_t* app) {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(STARTUPINFO);

    if (!CreateProcess(app, NULL, NULL, NULL, FALSE,
        CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
        cout << "Ошибка - " << GetLastError() << endl;
    }
    else {
        cout << "Программа запущена!" << endl;
    }
    return pi;
}

PROCESS_INFORMATION openPaint(wchar_t* app) {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(STARTUPINFO);

    if (!CreateProcess(app, NULL, NULL, NULL, FALSE,
        CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
        cout << "Ошибка - " << GetLastError() << endl;
    }
    else {
        cout << "Программа запущена!" << endl;
    }
    return pi;
}

PROCESS_INFORMATION openNotepad(wchar_t* app) {
    STARTUPINFO si;
    PROCESS_INFORMATION pi;

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(STARTUPINFO);

    if (!CreateProcess(app, NULL, NULL, NULL, FALSE,
        CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
        cout << "Ошибка - " << GetLastError() << endl;
    }
    else {
        cout << "Программа запущена!" << endl;
    }
    return pi;
}

void CloseProcess(PROCESS_INFORMATION pi) {
        TerminateProcess(pi.hProcess, 0);
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
}

int main()
{
    setlocale(0,"rus");
    wchar_t  AppWORD[] = L"C:\\Program Files\\Microsoft Office\\root\\Office16\\WINWORD.EXE";
    wchar_t  AppEXEL[] = L"C:\\Program Files\\Microsoft Office\\root\\Office16\\EXCEL.EXE";
    wchar_t AppPAINT[] = L"C:\\WINDOWS\\system32\\mspaint.exe";
    wchar_t  AppNotepad[] = L"C:\\WINDOWS\\system32\\notepad.exe";

    bool exit = false;

    int countW = 0;
    int countE = 0;
    int countP = 0;
    int countN = 0;

    STARTUPINFO si;
    PROCESS_INFORMATION pi;
    SECURITY_ATTRIBUTES sa;

    DWORD idThread;
    HANDLE hThread;

    sa.nLength = sizeof(SECURITY_ATTRIBUTES);
    sa.lpSecurityDescriptor = NULL;
    sa.bInheritHandle = TRUE;

    hThread = CreateThread(&sa, 0, (LPTHREAD_START_ROUTINE)thread, NULL, 0, &idThread);

    ZeroMemory(&si, sizeof(STARTUPINFO));
    si.cb = sizeof(STARTUPINFO);

    //было wchar_t childApp = L"C:\\Sitkov\\pr9_Sitkov_cpp\\x64\\Debug\\child_process.exe %I64u";

    wchar_t cmdLine[256];
    swprintf_s(cmdLine, L"C:\\Sitkov\\pr9_Sitkov_cpp\\x64\\Debug\\child_process.exe %d", (int)hThread);

    if (!CreateProcess(NULL, cmdLine, NULL, NULL, TRUE,   
        CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi)) {
        cout << "Ошибка - " << GetLastError() << endl;
    }

    while (!exit) {
        int otv;
        cout << "---------------------------" << endl;
        cout << "Какое приложение открыть?" << endl;
        cout << "1. Word" << endl;
        cout << "2. Exel" << endl;
        cout << "3. Paint" << endl;
        cout << "4. Notepad" << endl;
        cout << "---------------------------" << endl;
        cout << "Какое приложение закрыть?" << endl;
        cout << "5. closeWord" << endl;
        cout << "6. closeExcel" << endl;
        cout << "7. closePaint" << endl;
        cout << "8. closeNotepad" << endl;
        cout << "" << endl;
        cout << "9. Exit" << endl;
        cout << " " << endl;
        cin >> otv;

        switch (otv) {
            case 1:
                system("cls");
                piWord[countW] = openWord(AppWORD);
                countW++;
                break;
            case 2:
                system("cls");
                piExcel[countE] = openExel(AppEXEL);
                countE++;
                break;
            case 3:
                system("cls");
                piPaint[countP] = openPaint(AppPAINT);
                countP++;
                break;
            case 4:
                system("cls");
                piNotepad[countN] = openNotepad(AppNotepad);
                countN++;
                break;
            case 5:
                system("cls");
                if (countW > 0) {
                    if (piWord[countW - 1].hProcess != NULL) {
                        CloseProcess(piWord[countW - 1]);
                        countW--;
                    }
                }
                else {
                    cout << "" << endl;
                    cout << "Процесс не найден!!!" << endl;
                }
                break;
            case 6:
                system("cls");
                if (countE > 0) {
                    if (piExcel[countE - 1].hProcess != NULL) {
                        CloseProcess(piExcel[countE - 1]);
                        countE--;
                    }
                }

                else {
                    cout << "" << endl;
                    cout << "Процесс не найден!!!" << endl;
                }
                break;
            case 7:
                system("cls");
                if (countP > 0) {
                    if (piPaint[countP - 1].hProcess != NULL) {
                        CloseProcess(piPaint[countP - 1]);
                        countP--;
                    }
                }
                else {
                    cout << "" << endl;
                    cout << "Процесс не найден!!!" << endl;
                }
                break;
            case 8:
                system("cls");
                if (countN > 0) {
                    if (piNotepad[countN - 1].hProcess != NULL) {
                        CloseProcess(piNotepad[countN - 1]);
                        countN--;
                    }
                }

                else {
                    cout << "" << endl;
                    cout << "Процесс не найден!!!" << endl;
                }
                break;
            case 9:
                system("cls");
                exit = true;
                break;
            default:
                cout << "" << endl;
                cout << "Такого варианта нет.." << endl;
                   break;
        }
    }
    return 0;
}
